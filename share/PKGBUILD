# Contributor: malex984 at googlemail dot com

pkgname=msrp-git
pkgver=20101203
pkgrel=1
pkgdesc="Meta search and replace tool for both filenames and files: improved"
arch=('i686' 'x86_64')
url="https://github.com/malex984/msrp"
license=("unknown")
groups=()
depends=(pcre)
makedepends=('git' 'pkg-config' 'automake' 'autoconf')
conflicts=('msrp')
provides=('msrp')
replaces=(msrp)
backup=()
options=()
install=
noextract=()

_gitroot="git://github.com/malex984/msrp.git"
_gitname="msrp"

build() {
    cd ${srcdir}

    msg "Connecting to the git repository..."
    if [ -d ${srcdir}/${_gitname} ]; then
        cd ${_gitname}
        git pull origin
    else
        git clone --depth 1 -b master ${_gitroot} 
    fi
    msg "GIT checkout done or server timeout"

    rm -rf ${srcdir}/${_gitname}-build
    cp -r  ${srcdir}/${_gitname} ${srcdir}/${_gitname}-build
    cd ${srcdir}/${_gitname}-build

    msg "Generating 'configure'..."
    aclocal && automake --add-missing && autoconf

    msg "Configuring..."
    ./configure --prefix=/usr

    msg "Starting make..."
    make || return 1
    
    msg "Starting file.cc test..."
    cd test || return 1
    ./all.sh || return 1
    cd -
    
    msg "Installing..."
    make DESTDIR="${pkgdir}/" install || return 1
}
